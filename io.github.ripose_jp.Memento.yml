app-id: io.github.ripose_jp.Memento
runtime: org.kde.Platform
runtime-version: 6.9
sdk: org.kde.Sdk
command: memento
rename-desktop-file: memento.desktop
rename-icon: memento

finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=all
  - --share=network
  - --socket=pulseaudio
  - --filesystem=/tmp:rw
  - --filesystem=xdg-pictures:rw
  - --filesystem=xdg-videos:rw
  - --filesystem=host:ro
  - --env=LC_NUMERIC=C
  - --filesystem=xdg-run/pipewire-0:ro
  - --env=YT_DLP_JS_RUNTIME=deno

  - --talk-name=org.freedesktop.ScreenSaver

cleanup:
  - '*.la'
  - '*.a'

modules:
  - name: lmdb
    sources:
      - sha256: f3927859882eb608868c8c31586bb7eb84562a40a6bf5cc3e13b6b564641ea28
        type: archive
        url: https://github.com/LMDB/lmdb/archive/LMDB_0.9.22.tar.gz
    make-install-args:
      - prefix=/app
    no-autogen: true
    subdir: libraries/liblmdb

  - name: parse-yapp
    buildsystem: simple
    build-commands:
      - perl Makefile.PL INSTALL_BASE=/app
      - make
      - make install
    sources:
      - type: archive
        url: https://cpan.metacpan.org/authors/id/W/WB/WBRASWELL/Parse-Yapp-1.21.tar.gz
        sha256: 3810e998308fba2e0f4f26043035032b027ce51ce5c8a52a8b8e340ca65f13e5

  - name: smbclient
    config-opts:
      - --without-json
      - --without-ad-dc
      - --without-ldap
      - --without-ads
      - --without-pam
      - --disable-python
      - --disable-cups
      - --disable-iprint
      - --without-systemd
      - --bindir=.
      - --sbindir=.
      - --sysconfdir=.
    cleanup:
      - /lib/perl5
    build-options:
      env:
        PERL5LIB: /app/lib/perl5
    buildsystem: autotools
    sources:
      - type: archive
        archive-type: tar
        url: https://download.samba.org/pub/samba/stable/samba-4.23.3.tar.gz
        sha256: 06cdbb27a6956978b045455fe0696d998ffbac8d24ba24de87a4ef8200813320
        x-checker-data:
          type: html
          url: https://download.samba.org/pub/samba/stable/?C=M;O=D
          version-pattern: samba-(\d+\.\d+\.\d+).tar.gz
          url-template: https://download.samba.org/pub/samba/stable/samba-$version.tar.gz

  - name: libXmu
    buildsystem: autotools
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/xorg/lib/libxmu.git
        tag: libXmu-1.2.1
        commit: 792f80402ee06ce69bca3a8f2a84295999c3a170
        x-checker-data:
          type: git
          tag-pattern: ^libXmu-([\d.]+)$

  - name: xclip
    buildsystem: autotools
    sources:
      - type: git
        url: https://github.com/astrand/xclip.git
        tag: '0.13'
        commit: 9aa7090c3b8b437c6489edca32ae43d82e0c1281
        x-checker-data:
          type: git
          tag-pattern: ^(\d+\.\d+)$

  - name: libXpresent
    buildsystem: autotools
    sources:
      - type: git
        url: https://gitlab.freedesktop.org/xorg/lib/libxpresent.git
        tag: libXpresent-1.0.2
        commit: 4d92149372461bf575e8a09b1064a2884c38c3aa
        x-checker-data:
          type: git
          tag-pattern: ^libXpresent-([\d.]+)$

  - name: luajit
    no-autogen: true
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share/man
    sources:
      - type: git
        url: https://github.com/LuaJIT/LuaJIT.git
        disable-shallow-clone: true
        commit: 7152e15489d2077cd299ee23e3d51a4c599ab14f
      - type: shell
        commands:
          - sed -i 's|/usr/local|/app|' ./Makefile

  - name: deno
    buildsystem: simple
    build-commands:
      - install -Dm755 deno /app/bin/deno
    sources:
      # -------- x86_64 build --------
      - type: file
        only-arches:
          - x86_64
        url: https://github.com/denoland/deno/releases/download/v2.5.6/deno-x86_64-unknown-linux-gnu.zip
        sha256: fd4f6abc1b6a134fa9a4dba56519f1631f44c88e04e4e3e9a8ff5975dfa66e1a
        dest-filename: deno.zip

      # -------- aarch64 build --------
      - type: file
        only-arches:
          - aarch64
        url: https://github.com/denoland/deno/releases/download/v2.5.6/deno-aarch64-unknown-linux-gnu.zip
        sha256: f5e60ae3dfceb61e5e5a41f22129e40a8bc17f6393b59e75d7ca19ceef32d824
        dest-filename: deno.zip

      # -------- unpack the zip --------
      - type: shell
        commands:
          - unzip deno.zip

  - name: yt-dlp-ejs
    buildsystem: simple
    build-commands:
      - pip3 install --prefix=/app yt_dlp_ejs*.whl
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/9d/0d/1f0d7a735ca60b87953271b15d00eff5eef05f6118390ddf6f81982526ed/yt_dlp_ejs-0.3.2-py3-none-any.whl
        sha256: f2dc6b3d1b909af1f13e021621b0af048056fca5fb07c4db6aa9bbb37a4f66a9
        x-checker-data:
          type: pypi
          name: yt-dlp-ejs
          packagetype: bdist_wheel

  - name: yt-dlp
    no-autogen: true
    no-make-install: true
    make-args:
      - yt-dlp
      - PYTHON=/usr/bin/python3
    post-install:
      - install yt-dlp /app/bin
    sources:
      - type: archive
        url: https://github.com/yt-dlp/yt-dlp/releases/download/2025.12.08/yt-dlp.tar.gz
        sha256: 9814ae7dd4118a80a6104399d4984e355d2a71f78e6bbc48137a5b299eddcbaf
        x-checker-data:
          type: json
          url: https://api.github.com/repos/yt-dlp/yt-dlp/releases/latest
          version-query: .tag_name
          url-query: .assets[] | select(.name=="yt-dlp.tar.gz") | .browser_download_url

  - name: uchardet
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_STATIC=0
      - -DCMAKE_INSTALL_LIBDIR=lib
      # TODO can be removed when updating to uchardet > 0.0.8
      - -DCMAKE_POLICY_VERSION_MINIMUM=3.5
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share/man
    sources:
      - type: archive
        url: https://www.freedesktop.org/software/uchardet/releases/uchardet-0.0.8.tar.xz
        sha256: e97a60cfc00a1c147a674b097bb1422abd9fa78a2d9ce3f3fdcc2e78a34ac5f0
        x-checker-data:
          type: html
          url: https://www.freedesktop.org/software/uchardet/releases/
          version-pattern: uchardet-(\d\.\d+\.?\d*).tar.xz
          url-template: https://www.freedesktop.org/software/uchardet/releases/uchardet-$version.tar.xz

  - name: libass
    cleanup:
      - /include
      - /lib/pkgconfig
    config-opts:
      - --disable-static
      - --enable-asm
      - --enable-harfbuzz
      - --enable-fontconfig
    sources:
      - type: git
        url: https://github.com/libass/libass.git
        tag: 0.17.4
        commit: bbb3c7f1570a4a021e52683f3fbdf74fe492ae84
        x-checker-data:
          type: git
          tag-pattern: ^(\d\.\d{1,3}\.\d{1,2})$

#  - name: libv4l2
#    buildsystem: meson
#    config-opts:
#      - --libdir=lib
#      - -Ddoxygen-html=false
#      - -Ddoxygen-doc=disabled
#      - -Dbpf=disabled
#      - -Dudevdir=/app/lib/udev
#    cleanup:
#      - /include
#      - /lib/pkgconfig
#      - /share/man
#    sources:
#      - type: git
#        url: https://git.linuxtv.org/v4l-utils.git
#        mirror-urls:
#          - https://github.com/gjasny/v4l-utils.git
#        tag: v4l-utils-1.28.1
#        commit: fc15e229d9d337e46d730f00647821adbbd58548
#        x-checker-data:
#          type: git
#          tag-pattern: ^v4l-utils-([\d.]+)$
#
  - name: libcdio
    config-opts:
      - --disable-static
      - --disable-example-progs
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/libcdio/libcdio-2.1.0.tar.bz2
        mirror-urls:
          - https://mirrors.kernel.org/gnu/libcdio/libcdio-2.1.0.tar.bz2
          - https://mirrors.ocf.berkeley.edu/gnu/libcdio/libcdio-2.1.0.tar.bz2
          - https://ftpmirror.gnu.org/gnu/libcdio/libcdio-2.1.0.tar.bz2
        sha256: 8550e9589dbd594bfac93b81ecf129b1dc9d0d51e90f9696f1b2f9b2af32712b
        x-checker-data:
          type: html
          url: https://ftp.gnu.org/gnu/libcdio/
          version-pattern: libcdio-(\d\.\d+\.?\d*).tar.bz2
          url-template: https://ftp.gnu.org/gnu/libcdio/libcdio-$version.tar.bz2

  - name: libcdio-paranoia
    config-opts:
      - --disable-static
      - --disable-example-progs
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://ftp.gnu.org/gnu/libcdio/libcdio-paranoia-10.2+2.0.2.tar.bz2
        mirror-urls:
          - https://mirrors.kernel.org/gnu/libcdio/libcdio-paranoia-10.2+2.0.1.tar.bz2
          - https://mirrors.ocf.berkeley.edu/gnu/libcdio/libcdio-paranoia-10.2+2.0.1.tar.bz2
          - https://ftpmirror.gnu.org/gnu/libcdio/libcdio-paranoia-10.2+2.0.1.tar.bz2
        sha256: 186892539dedd661276014d71318c8c8f97ecb1250a86625256abd4defbf0d0c
        x-checker-data:
          type: html
          url: https://ftp.gnu.org/gnu/libcdio/
          version-pattern: libcdio-paranoia-([\d\.\+-]+).tar.bz2
          url-template: https://ftp.gnu.org/gnu/libcdio/libcdio-paranoia-$version.tar.bz2

  - name: libdvdread
    buildsystem: meson
    config-opts:
      - --libdir=lib
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://download.videolan.org/pub/videolan/libdvdread/7.0.1/libdvdread-7.0.1.tar.xz
        sha256: 2e3e04a305c15c3963aa03ae1b9a83c1d239880003fcf3dde986d3943355d407
        x-checker-data:
          type: html
          url: https://www.videolan.org/developers/libdvdnav.html
          version-pattern: The latest version of <code>libdvdread</code> is <b>([\d\-\.]+)<
          url-template: https://download.videolan.org/pub/videolan/libdvdread/$version/libdvdread-$version.tar.xz

  - name: libdvdnav
    buildsystem: meson
    config-opts:
      - --libdir=lib
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: archive
        url: https://download.videolan.org/pub/videolan/libdvdnav/7.0.0/libdvdnav-7.0.0.tar.xz
        sha256: a2a18f5ad36d133c74bf9106b6445806fa253b09141a46392550394b647b221e
        x-checker-data:
          type: html
          url: https://www.videolan.org/developers/libdvdnav.html
          version-pattern: The latest version of <code>libdvdnav</code> is <b>([\d\-\.]+)</b>\.
          url-template: https://download.videolan.org/pub/videolan/libdvdnav/$version/libdvdnav-$version.tar.xz

  # libgcrypt-1.10.3 build fails with freedeskop 24.08
  - name: libgcrypt
    config-opts:
      - --disable-static
      - --disable-doc
    sources:
      - type: git
        url: https://dev.gnupg.org/source/libgcrypt.git
        tag: libgcrypt-1.10.3
        commit: aa1610866f8e42bdc272584f0a717f32ee050a22
        # disabled for libgcrypt-1.11 because of build fail
        #x-checker-data:
        #  type: anitya
        #  project-id: 1623
        #  stable-only: true
        #  tag-template: libgcrypt-$version

  - name: libaacs
    config-opts:
      - --disable-static
      - --disable-bdjava-jar
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - sha256: a88aa0ebe4c98a77f7aeffd92ab3ef64ac548c6b822e8248a8b926725bea0a39
        type: archive
        url: https://download.videolan.org/pub/videolan/libaacs/0.11.1/libaacs-0.11.1.tar.bz2
        mirror-urls:
          - https://videolan.mirror.ba/libaacs/0.11.1/libaacs-0.11.1.tar.bz2
          - https://videolan.c3sl.ufpr.br/libaacs/0.11.1/libaacs-0.11.1.tar.bz2
        x-checker-data:
          type: html
          url: https://www.videolan.org/developers/libaacs.html
          version-pattern: Latest release is <b>libaacs (\d\.\d+\.?\d*)</b>
          url-template: https://download.videolan.org/pub/videolan/libaacs/$version/libaacs-$version.tar.bz2

  - name: libbluray
    buildsystem: meson
    config-opts:
      - --libdir=lib
      - -Dbdj_jar=disabled
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - sha256: 77937baf07eadda4b2b311cf3af4c50269d2ea3165041f5843d96476c4c92777
        type: archive
        url: https://download.videolan.org/pub/videolan/libbluray/1.4.0/libbluray-1.4.0.tar.xz
        mirror-urls:
          - https://videolan.mirror.ba/libbluray/1.4.0/libbluray-1.4.0.tar.xz
          - https://videolan.c3sl.ufpr.br/libbluray/1.4.0/libbluray-1.4.0.tar.xz
        x-checker-data:
          type: html
          url: https://www.videolan.org/developers/libbluray.html
          version-pattern: Latest release is <b>libbluray (\d\.\d+\.?\d*)</b>\.
          url-template: https://download.videolan.org/pub/videolan/libbluray/$version/libbluray-$version.tar.xz

  - name: zimg
    config-opts:
      - --disable-static
    cleanup:
      - /include
      - /lib/pkgconfig
      - /share/doc
    sources:
      - type: archive
        archive-type: tar
        url: https://api.github.com/repos/sekrit-twc/zimg/tarball/release-3.0.6
        sha256: 15140e491c4ce9db5f02a038d8a1eb53e9151b55eeed06a2899425a6ebfef367
        x-checker-data:
          type: json
          url: https://api.github.com/repos/sekrit-twc/zimg/releases/latest
          url-query: .tarball_url
          version-query: .tag_name | sub("^release-"; "")
          timestamp-query: .published_at

  - name: Tesseract
    config-opts:
      - --disable-static
    modules:
      - name: Leptonica
        config-opts:
          - --disable-static
          - --with-pic
        sources:
          - type: archive
            url: http://www.leptonica.org/source/leptonica-1.86.0.tar.gz
            sha256: 1fa08e40bb37fd45802d5e6e7b43927449a5c47d4608ef99d3bd3f0fa76baedc
            x-checker-data:
              type: anitya
              project-id: 1549
              stable-only: true
              url-template: http://www.leptonica.org/source/leptonica-$version.tar.gz
        cleanup:
          - /bin
    sources:
      - type: git
        url: https://github.com/tesseract-ocr/tesseract.git
        tag: 5.5.1
        commit: 3b7c70e34dea179549ed3e995872e2e019eb8477
        x-checker-data:
          type: json
          url: https://api.github.com/repos/tesseract-ocr/tesseract/releases/latest
          timestamp-query: .published_at
          tag-query: .tag_name
          version-query: .tag_name
    cleanup:
      - /bin

  - name: ImageMagick
    config-opts:
      - --disable-static
      - --disable-docs
      - --with-hdri
      - --with-pic
    sources:
      - type: archive
        url: https://github.com/ImageMagick/ImageMagick/archive/7.1.2-10.tar.gz
        sha256: 122c961331044844141aef59f050e2bb3a0c89833c613950770d3672c4f2e4e8
        x-checker-data:
          type: anitya
          project-id: 1372
          stable-only: true
          url-template: https://github.com/ImageMagick/ImageMagick/archive/$version.tar.gz
    cleanup:
      - /bin
      - /etc
      - /lib/ImageMagick*
      - /share/ImageMagick*

  - name: rubberband
    buildsystem: meson
    config-opts:
      - --libdir=lib
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: git
        url: https://github.com/breakfastquay/rubberband.git
        #mirror-urls:
        #  - https://hg.sr.ht/~breakfastquay/rubberband
        tag: v4.0.0
        commit: 1d95888bec3ae0a17c0c4af791810d5a63f6bc35
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$

  - name: mujs
    buildsystem: autotools
    no-autogen: true
    make-args:
      - release
    make-install-args:
      - prefix=/app
      - install-shared
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
    sources:
      - type: git
        url: https://github.com/ccxvii/mujs.git
        #mirror-urls:
        #  - http://git.ghostscript.com/mujs.git
        tag: 1.3.6
        commit: cc569c5fa9a7a2498177693b5617605c2ff5b260
        # failing build for 1.3.7
        #x-checker-data:
        #  type: git
        #  url: https://api.github.com/repos/ccxvii/mujs/tags
        #  tag-pattern: ^([\d.]+)$

  - name: nv-codec-headers
    cleanup:
      - '*'
    no-autogen: true
    make-install-args:
      - PREFIX=/app
    sources:
      - type: git
        url: https://github.com/FFmpeg/nv-codec-headers.git
        tag: n13.0.19.0
        commit: e844e5b26f46bb77479f063029595293aa8f812d
        x-checker-data:
          type: git
          tag-pattern: ^n([\d.]+)$

  - name: x264
    cleanup:
      - /include
      - /lib/pkgconfig
      - /share/man
    config-opts:
      - --disable-cli
      - --enable-shared
    sources:
      - type: git
        url: https://code.videolan.org/videolan/x264.git
        commit: b35605ace3ddf7c1a5d67a2eb553f034aef41d55

  - name: x265
    buildsystem: cmake
    subdir: source
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_INSTALL_LIBDIR=lib
      - -DBUILD_STATIC=0
      # TODO can be removed when updating to x265 > 4.1
      - -DCMAKE_POLICY_VERSION_MINIMUM=3.5
    cleanup:
      - /include
      - /lib/pkgconfig
      - /share/man
    sources:
      - type: git
        url: https://bitbucket.org/multicoreware/x265_git.git
        tag: '4.0'
        commit: 6318f223684118a2c71f67f3f4633a9e35046b00
        # build is failing with 4.1 will enable with 4.2
        #x-checker-data:
        #  type: git
        #  tag-pattern: ^([\d.]+)$

      # fix cmake build issue
      # https://bitbucket.org/multicoreware/x265_git/commits/b354c009a60bcd6d7fc04014e200a1ee9c45c167
      - type: patch
        path: patches/x265-cmake_policy.patch

  - name: libmysofa
    buildsystem: cmake
    config-opts:
      - -DCMAKE_INSTALL_LIBDIR=lib
      - -DBUILD_TESTS=OFF
    sources:
      - type: git
        commit: 444d2c1d7ececf5cc2d96d3b17b209047b02318d
        tag: v1.3.3
        url: https://github.com/hoene/libmysofa.git
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$

  - name: libbs2b
    buildsystem: autotools
    config-opts:
      - --disable-static
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: archive
        archive-type: tar
        url: https://downloads.sourceforge.net/sourceforge/bs2b/libbs2b-3.1.0.tar.gz
        sha256: 6aaafd81aae3898ee40148dd1349aab348db9bfae9767d0e66e0b07ddd4b2528
        x-checker-data:
          type: html
          url: https://sourceforge.net/projects/bs2b/files/libbs2b/
          version-pattern: projects/bs2b/files/libbs2b/(\d+\.\d+\.\d+)
          url-template: https://downloads.sourceforge.net/sourceforge/bs2b/libbs2b-$version.tar.gz
      # https://src.fedoraproject.org/rpms/libbs2b/blob/rawhide/f/libbs2b.spec#_40
      - type: shell
        commands:
          - sed -i -e 's/lzma/xz/g' configure.ac
          - autoreconf -vif

#  - name: libjxl
#    buildsystem: cmake
#    config-opts:
#      - -DCMAKE_BUILD_TYPE=Release
#      - -DCMAKE_INSTALL_LIBDIR=lib
#      - -DBUILD_TESTING=OFF
#    sources:
#      - type: git
#        url: https://github.com/libjxl/libjxl.git
#        tag: v0.11.0
#        commit: 4df1e9eccdf86b8df4c0c7c08f529263906f9c4f
#        disable-shallow-clone: true
#        x-checker-data:
#          type: git
#          tag-pattern: ^v([\d.]+)$

#  - name: vulkan-headers
#    buildsystem: cmake-ninja
#    sources:
#      - type: archive
#        url: https://github.com/KhronosGroup/Vulkan-Headers/archive/v1.3.286.tar.gz
#        sha256: a82a6982efe5e603e23505ca19b469e8f3d876fc677c46b7bfb6177f517bf8fe

  - name: ffmpeg
    cleanup:
      - /include
      - /lib/pkgconfig
      - /share/ffmpeg/examples
    config-opts:
      - --disable-debug
      - --disable-doc
      - --disable-static
      - --enable-encoder=png
      - --enable-gnutls
      - --enable-gpl
      - --enable-shared
      - --enable-version3
      - --enable-libaom
      - --enable-libass
      - --enable-libbs2b
      - --enable-libdav1d
      - --enable-libfreetype
      - --enable-libmp3lame
      - --enable-libopus
      - --enable-libjxl
      - --enable-libmysofa
      - --enable-libtheora
      - --enable-libv4l2
      - --enable-libvorbis
      - --enable-libvpx
      - --enable-libx264
      - --enable-libx265
      - --enable-libwebp
      - --enable-libsmbclient
      - --enable-libxml2
      - --enable-vulkan
      - --enable-libdrm
      - --enable-vaapi

    sources:
      - type: git
        url: https://github.com/FFmpeg/FFmpeg.git
        #mirror-urls:
        #  - https://git.ffmpeg.org/ffmpeg.git
        commit: 894da5ca7d742e4429ffb2af534fcda0103ef593
        tag: n8.0.1
        x-checker-data:
          type: git
          tag-pattern: ^n([\d.]{3,7})$

  - name: libsixel
    buildsystem: meson
    config-opts:
      - --libdir=lib
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: archive
        archive-type: tar
        url: https://api.github.com/repos/libsixel/libsixel/tarball/refs/tags/v1.10.5
        sha256: 402da9e24caea62fe1e4c5d6f9c9211141f7a5d8016e717527ecde10c5522344
        x-checker-data:
          type: json
          url: https://api.github.com/repos/libsixel/libsixel/tags
          url-query: .[0].tarball_url
          version-query: .[0].name

  - name: libplacebo
    buildsystem: meson
    config-opts:
      - -Dvulkan=enabled
      - -Dshaderc=enabled
      - --libdir=lib
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: git
        url: https://github.com/haasn/libplacebo.git
        #mirror-urls:
        #  - https://code.videolan.org/videolan/libplacebo.git
        tag: v7.349.0
        commit: 1fd3c7bde7b943fe8985c893310b5269a09b46c5
        # Disabled libplacebo update above v7.349.0, though it compiles, but videos do not play/work with freedesktop sdk 24.08 due to vulkan 1.0; perhaps 25.08 may work.
        #x-checker-data:
        #  type: git
        #  tag-pattern: ^v([\d.]+)$

      # fix python error: TypeError: expected an Element, not ElementTree
      # https://code.videolan.org/videolan/libplacebo/-/commit/12509c0f1ee8c22ae163017f0a5e7b8a9d983a17
      - type: patch
        path: patches/libplacebo-vulkan-utils_gen-python.patch

## The following not needed as of freedesktop 24.08
#    modules:
#      - name: shaderc
#        buildsystem: cmake-ninja
#        builddir: true
#        config-opts:
#          - -DSHADERC_SKIP_COPYRIGHT_CHECK=ON
#          - -DSHADERC_SKIP_EXAMPLES=ON
#          - -DSHADERC_SKIP_TESTS=ON
#          - -DSPIRV_SKIP_EXECUTABLES=ON
#          - -DENABLE_GLSLANG_BINARIES=OFF
#        cleanup:
#          - /bin
#          - /include
#          - /lib/cmake
#          - /lib/pkgconfig
#        sources:
#          - type: git
#            url: https://github.com/google/shaderc.git
#            #tag: v2023.7
#            commit: 40bced4e1e205ecf44630d2dfa357655b6dabd04
#            #x-checker-data:
#            #  type: git
#            #  tag-pattern: ^v(\d{4}\.\d{1,2})$
#          - type: git
#            url: https://github.com/KhronosGroup/SPIRV-Tools.git
#            tag: v2024.1
#            commit: 04896c462d9f3f504c99a4698605b6524af813c1
#            dest: third_party/spirv-tools
#            #x-checker-data:
#            #  type: git
#            #  tag-pattern: ^v(\d{4}\.\d{1})$
#          - type: git
#            url: https://github.com/KhronosGroup/SPIRV-Headers.git
#            #tag: sdk-1.3.250.1
#            commit: 4f7b471f1a66b6d06462cd4ba57628cc0cd087d7
#            dest: third_party/spirv-headers
#             x-checker-data:
#               type: git
#               tag-pattern: ^sdk-([\d.]+)$
#          - type: git
#            url: https://github.com/KhronosGroup/glslang.git
#            tag: 15.0.0
#            commit: 46ef757e048e760b46601e6e77ae0cb72c97bd2f
#            dest: third_party/glslang
#            x-checker-data:
#              type: git
#              tag-pattern: ^(\d{1,2}\.\d{1,2}\.\d{1,4})$

  - name: hwdata
    buildsystem: autotools
    sources:
      - type: archive
        url: https://github.com/vcrhonek/hwdata/archive/refs/tags/v0.394.tar.gz
        sha256: b7c3fd7214a3b7c49d2661db127a712dc11cffd1799f793947aa1cb20aaf3298

  - name: libdisplay-info
    buildsystem: meson
    config-opts:
      - --libdir=lib
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/emersion/libdisplay-info/-/archive/0.2.0/libdisplay-info-0.2.0.tar.gz
        sha256: f7331fcaf5527251b84c8fb84238d06cd2f458422ce950c80e86c72927aa8c2b

  - name: mpv
    buildsystem: meson
    config-opts:
      - --libdir=lib
      - -Dalsa=enabled
      - -Dbuild-date=false
      - -Dcdda=enabled
      - -Dcplayer=true
      - -Dcplugins=enabled
      - -Dcuda-hwaccel=enabled
      - -Dcuda-interop=enabled
      - -Ddmabuf-wayland=enabled
      - -Ddrm=enabled
      - -Ddvbin=enabled
      - -Ddvdnav=enabled
      - -Degl-drm=enabled
      - -Degl-wayland=enabled
      - -Degl-x11=enabled
      - -Degl=enabled
      - -Dgbm=enabled
      - -Dgl-x11=enabled
      - -Dgl=enabled
      - -Diconv=enabled
      - -Djack=enabled
      - -Djavascript=enabled
      - -Djpeg=enabled
      - -Dlcms2=enabled
      - -Dlibarchive=enabled
      - -Dlibavdevice=enabled
      - -Dlibbluray=enabled
      - -Dlibmpv=true
      - -Dlua=enabled
      - -Dmanpage-build=disabled
      - -Dopenal=enabled
      - -Dpipewire=enabled
      - -Dplain-gl=enabled
      - -Dpulse=enabled
      - -Drubberband=enabled
      - -Duchardet=enabled
      - -Dvaapi-drm=enabled
      - -Dvaapi-wayland=enabled
      - -Dvaapi-x11=enabled
      - -Dvaapi=enabled
      - -Dvdpau-gl-x11=enabled
      - -Dvdpau=enabled
      - -Dvector=enabled
      - -Dvulkan=disabled
      - -Dwayland=enabled
      - -Dwerror=false
      - -Dx11=enabled
      - -Dxv=enabled
      - -Dzimg=enabled
      - -Dzlib=enabled
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share
    sources:
      - type: git
        url: https://github.com/mpv-player/mpv.git
        tag: v0.41.0
        commit: 41f6a645068483470267271e1d09966ca3b9f413
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$

  - name: libzip
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DCMAKE_INSTALL_LIBDIR=lib
    cleanup:
      - /include
    sources:
      - type: archive
        url: https://libzip.org/download/libzip-1.11.4.tar.gz
        sha256: 82e9f2f2421f9d7c2466bbc3173cd09595a88ea37db0d559a9d0a2dc60dc722e
        x-checker-data:
          type: anitya
          project-id: 10649
          stable-only: true
          url-template: https://libzip.org/download/libzip-$version.tar.gz

  - name: json-c
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DCMAKE_INSTALL_LIBDIR=lib
    cleanup:
      - /include
    sources:
      - type: git
        url: https://github.com/json-c/json-c.git
        tag: json-c-0.18-20240915
        commit: 41a55cfcedb54d9c1874f2f0eb07b504091d7e37
        x-checker-data:
          type: git
          url: https://api.github.com/repos/json-c/json-c/tags
          tag-pattern: ^json-c-([\d.]+)-\d+$

  - name: mecab
    buildsystem: autotools
    config-opts:
      - --with-charset=utf-8
    cleanup:
      - /bin
      - /include
      - /libexec/mecab/mecab-*
    sources:
      - type: archive
        archive-type: tar
        url: https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/mecab/mecab-0.996.tar.gz
        sha256: e073325783135b72e666145c781bb48fada583d5224fb2490fb6c1403ba69c59
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} .

  - name: mecab-ipadic
    buildsystem: autotools
    config-opts:
      - --with-charset=utf-8
    cleanup:
      - /bin
      - /include
      - /libexec/mecab/mecab-*
    sources:
      - type: archive
        archive-type: tar
        url: https://storage.googleapis.com/google-code-archive-downloads/v2/code.google.com/mecab/mecab-ipadic-2.7.0-20070801.tar.gz
        sha256: b62f527d881c504576baed9c6ef6561554658b175ce6ae0096a60307e49e3523
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} .

  - name: qcoro
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DCMAKE_INSTALL_LIBDIR=lib
      - -DQCORO_BUILD_EXAMPLES=OFF
      - -DQCORO_BUILD_TESTING=OFF
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: git
        url: https://github.com/qcoro/qcoro.git
        tag: v0.12.0
        commit: ef1231ae490465b4f592ca326eee6d56a3d802ae
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$

  - name: memento
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_INSTALL_LIBDIR=lib
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DRELEASE_BUILD=ON
      - -DSYSTEM_QCORO=ON
      - -DMECAB_SUPPORT=ON
    sources:
      - type: git
        url: https://github.com/ripose-jp/Memento.git
        tag: v1.7.1
        commit: 35b6f789f2823919c42f1641c7b9ef5fac26e6a6
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
      - type: file
        path: io.github.ripose_jp.Memento.metainfo.xml
      - type: patch
        path: patches/memento-fix-screensaver.patch
    post-install:
      - install -Dm644 $FLATPAK_BUILDER_BUILDDIR/$FLATPAK_ID.metainfo.xml /app/share/metainfo/$FLATPAK_ID.metainfo.xml
